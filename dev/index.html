<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · Wahoo.jl</title><meta name="title" content="Home · Wahoo.jl"/><meta property="og:title" content="Home · Wahoo.jl"/><meta property="twitter:title" content="Home · Wahoo.jl"/><meta name="description" content="Documentation for Wahoo.jl."/><meta property="og:description" content="Documentation for Wahoo.jl."/><meta property="twitter:description" content="Documentation for Wahoo.jl."/><meta property="og:url" content="https://scheidan.github.io/Wahoo.jl/"/><meta property="twitter:url" content="https://scheidan.github.io/Wahoo.jl/"/><link rel="canonical" href="https://scheidan.github.io/Wahoo.jl/"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>Wahoo.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li class="toplevel"><a class="tocitem" href="#Usage"><span>Usage</span></a></li><li><a class="tocitem" href="#Defining-observation-models"><span>Defining observation models</span></a></li><li><a class="tocitem" href="#Using-GPU"><span>Using GPU</span></a></li><li class="toplevel"><a class="tocitem" href="#API"><span>API</span></a></li><li class="toplevel"><a class="tocitem" href="#References"><span>References</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/scheidan/Wahoo.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/scheidan/Wahoo.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p>Documentation for <a href="https://github.com/scheidan/Wahoo.jl">Wahoo</a>.</p><ul><li><a href="#Wahoo.track"><code>Wahoo.track</code></a></li></ul><h1 id="Wahoo.jl"><a class="docs-heading-anchor" href="#Wahoo.jl">Wahoo.jl</a><a id="Wahoo.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Wahoo.jl" title="Permalink"></a></h1><p>Wahoo is a package designed for tracking the movement of marine animals using probabilistic models</p><h1 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h1><p><code>] add git@github.com:scheidan/Wahoo.jl.git</code></p><h1 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h1><p>The following example uses example data that come with <code>Wahoo.jl</code>.</p><pre><code class="language-julia hljs">using Wahoo

import GeoArrays
using DelimitedFiles: readdlm

# This is optional. If *both* packages are imported,
# some computations use the GPU. Otherwise, the CPU is used for everything.
import CUDA
import cuDNN</code></pre><h3 id="1)-Bathymetry"><a class="docs-heading-anchor" href="#1)-Bathymetry">1) Bathymetry</a><a id="1)-Bathymetry-1"></a><a class="docs-heading-anchor-permalink" href="#1)-Bathymetry" title="Permalink"></a></h3><p>Load the bathymetry map which provides depth information for each grid cell.</p><pre><code class="language-julia hljs">pathdata = joinpath(pkgdir(Wahoo), &quot;example_data&quot;)
bathymetry_map = GeoArrays.read(joinpath(pathdata, &quot;bathymetry_200m.tif&quot;))
GeoArrays.bbox(bathymetry_map)</code></pre><h3 id="2)-Depth-observations"><a class="docs-heading-anchor" href="#2)-Depth-observations">2) Depth observations</a><a id="2)-Depth-observations-1"></a><a class="docs-heading-anchor-permalink" href="#2)-Depth-observations" title="Permalink"></a></h3><p>Read the depth measurements and define the exponential likelihood model. This model implies the fish is more likely close to the seabed.</p><pre><code class="language-julia hljs"># read depth signals
depth_signals = readdlm(joinpath(pathdata, &quot;depth_observations.csv&quot;), &#39;,&#39;, header=true)[1][:,2]

# define likelihood
function p_obs_depth_exponential(signals, t, waterdepth, dist; scale=30f0)
    signal = signals[t]
    if signal &gt; waterdepth         # water is too shallow
        return zero(waterdepth)
    else
        # exponential
        Z = 1 - exp(-waterdepth/scale) # normalisation due to truncation
        exp(-(waterdepth - signal)/scale)/(scale * Z)
    end
end</code></pre><h3 id="3)-Acoustic-observations"><a class="docs-heading-anchor" href="#3)-Acoustic-observations">3) Acoustic observations</a><a id="3)-Acoustic-observations-1"></a><a class="docs-heading-anchor-permalink" href="#3)-Acoustic-observations" title="Permalink"></a></h3><p>Load acoustic detection data and specify the probability model for acoustic signals given the distance.</p><pre><code class="language-julia hljs"># read acoustic signals
acoustic_signals = readdlm(joinpath(pathdata, &quot;acoustic_observations.csv&quot;), &#39;,&#39;, header=true)[1][:,2:3]
acoustic_signals = Int.(acoustic_signals&#39;)
acoustic_obs = [acoustic_signals[1,:], acoustic_signals[2,:]]

# read sensor positions
moorings = readdlm(joinpath(pathdata, &quot;acoustic_moorings.csv&quot;), &#39;,&#39;, header=true)[1]
acoustic_pos = tuple.(moorings[:,2], moorings[:,3])

# define likelihood
function p_obs_acoustic(signals, t::Int, depth::Number, distance::Number)
    Wahoo.p_acoustic_sigmoid(signals[t], depth, distance)
end</code></pre><h3 id="4)-Define-parameters"><a class="docs-heading-anchor" href="#4)-Define-parameters">4) Define parameters</a><a id="4)-Define-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#4)-Define-parameters" title="Permalink"></a></h3><p>We define initial distribution of the fish location and configures the model parameters such as time steps, movement capabilities of the fish, and spatial resolution of the bathymetry.</p><pre><code class="language-julia hljs">
# initial values: Matrix{Float64}
p0 = zeros(size(bathymetry_map)[1], size(bathymetry_map)[2])
idx = GeoArrays.indices(bathymetry_map, (709757.111649658, 6.26772603565296e6)) # last known location of the fish
p0[idx] = 1

tsave = 1:2:720             # time steps to save
movement_std = 100          # standard deviation of the fish movement for one time step [m]
spatial_resolution = 200    # spatial resolution [m]</code></pre><h3 id="5)-Run-inference"><a class="docs-heading-anchor" href="#5)-Run-inference">5) Run inference</a><a id="5)-Run-inference-1"></a><a class="docs-heading-anchor-permalink" href="#5)-Run-inference" title="Permalink"></a></h3><p>Finally, we run the model inference combine all observations and assumptions.</p><pre><code class="language-julia hljs">
res = track(pos_init = p0, bathymetry = bathymetry_map,
            tsave = tsave,
            spatial_resolution = spatial_resolution,
            movement_std = movement_std,
            observations = [depth_signals, acoustic_obs...],
            observation_models = [p_obs_depth_exponential, acoustic_obs_models...],
            sensor_positions = [nothing, acoustic_pos...],
            n_trajectories = 2)

# Resulting probabilities
# Array{Float32, 4}: Ny × Nx × 1 × time
res.pos_smoother     # Prob(s_t | y_{1...T})
res.pos_filter       # Prob(s_t | y_{1...t}), only if `save_filter = true` was used
res.residence_dist   # 1/T Σ Prob(s_t | y_{1...T})
res.trajectories     # Vector of trajectories sampled from Prob(s_{1...T} | y_{1...T})
res.log_p            # Prob(y_t)
res.tsave            # time points</code></pre><h2 id="Defining-observation-models"><a class="docs-heading-anchor" href="#Defining-observation-models">Defining observation models</a><a id="Defining-observation-models-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-observation-models" title="Permalink"></a></h2><h2 id="Using-GPU"><a class="docs-heading-anchor" href="#Using-GPU">Using GPU</a><a id="Using-GPU-1"></a><a class="docs-heading-anchor-permalink" href="#Using-GPU" title="Permalink"></a></h2><p>todo</p><h1 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Wahoo.track" href="#Wahoo.track"><code>Wahoo.track</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Tracks the location of the fish</p><pre><code class="nohighlight hljs">track(;pos_init::Matrix,
       tsave::AbstractVector = 1:100,
       bathymetry::GeoArrays.GeoArray,
       observations::Vector,
       observation_models::Vector{Function},
       sensor_positions::Vector,
       spatial_resolution,
       movement_std,
       save_filter::Bool = false,
       n_trajectories::Int = 0,
       show_progressbar::Bool = !is_logging(stderr),
       precision = Float32)</code></pre><p>Infers the location of the animal based on a diffusion model and smoothing.</p><p><strong>Keyword Arguments</strong></p><ul><li><code>pos_init::Matrix</code>: Initial probability distribution of the fish position</li><li><code>tsave::AbstractVector</code>: Time steps at which the probability map is saved.</li><li><code>bathymetry</code>: Bathymetric data as <code>GeoArray</code></li><li><code>spatial_resolution</code>: the spatial resolution [m] of the <code>bathymetry</code>.</li><li><code>movement_std</code>: Standard deviation of the fish movement within one time step [m]</li><li><code>observations</code>: Vector holding all observations. Each element contains the observation of a separate sensor.</li><li><code>observation_models::Vector{Function}</code>: Vector containing the observation model for each sensor.</li><li><code>sensor_positions</code>: Vector of tuples of coordinates or <code>nothing</code>, i.e. <code>Vector{Union{Nothing, Tuple{Real, Real}}}</code></li><li><code>save_filter</code>: if <code>true</code> the probabilities from the filter run are returned.</li><li><code>n_trajectories=0</code>: Number of trajectories to sample</li><li><code>show_progressbar = !is_logging(stderr)</code>: defaults to <code>true</code> for interactive use.</li><li><code>precision = Float32</code>: numerical floating point type used for computations</li></ul><p>Note, the elements of the vectors <code>observations</code>, <code>observation_models</code>, and <code>sensor_positions</code> must be sorted in the same way, i.e. the elements at the same position in the Vectors refer to the same sensor.</p><p><strong>Return</strong></p><p>A named tuple with the following elements:</p><ul><li><code>pos_smoother</code>: Smoothed probability distribution of the fish positions for all timesteps in <code>tsave</code>.</li><li><code>residence_dist</code>: Residence distribution.</li><li><code>trajectories</code>: Sampled trajectories if <code>n_trajectories</code> &gt; 0, otherwise <code>nothing</code>.</li><li><code>log_p</code>: Log probability of the observations.</li><li><code>tsave</code>: Vector of time steps at which the results are saved.</li><li><code>pos_filter</code>: Filtered  probability distribution of the fish positions, included if <code>save_filter = true</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/scheidan/Wahoo.jl/blob/d1c2534c8cce33e905c9560c2135d66c461bbdd1/src/Wahoo.jl#L8-L56">source</a></section></article><h1 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h1><p>The filter and smoother implementation is based on:</p><p>Thygesen, Uffe Høgsbro, Martin Wæver Pedersen, and Henrik Madsen. 2009. “Geolocating Fish Using Hidden Markov Models and Data Storage Tags.” In Tagging and Tracking of Marine Animals with Electronic Devices, 277–93. Dordrecht: Springer Netherlands. https://doi.org/10.1007/978-1-4020-9640-2_17.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Thursday 17 April 2025 09:10">Thursday 17 April 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
